<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="Indie elements catalog">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>Indie catalog</title>
    <meta name="description" content="Indie elements catalog">

    <link rel="import" href="bower_components/polymer/polymer-element.html">
    <link rel="import" href="bower_components/polymer/lib/elements/dom-repeat.html">
    <link rel="import" href="bower_components/iron-ajax/iron-ajax.html">
    <link rel="import" href="bower_components/iron-location/iron-location.html">
    <link rel="import" href="elements/content-wrapper.html">
    <link rel="import" href="elements/list-item.html">
    <script src="bower_components/webcomponentsjs/webcomponents-loader.js"></script>
    <style>
      html {
        --header-background: #fbbc05;
        --header-foreground: rgba(0,0,0,.7);
      }
      body {
        margin: 0;
        font-family: 'Roboto', 'Noto', sans-serif;
        line-height: 1.5;
        min-height: 100vh;
        background-color: #eeeeee;
      }
      list-item {
        padding: 8px 28px;
      }
    </style>
  </head>
  <body>
    <iron-location id="url" path="null"></iron-location>
    <content-wrapper>
      <dom-repeat>
        <template>
          <list-item
              name="[[item.name]]"
              action=[[item.action]]
              demo="[[item.demo]]"
              docs="[[item.docs]]">
          </list-item>
        </template>
      </dom-repeat>
    </content-wrapper>

    <noscript>
      Please enable JavaScript to view this website.
    </noscript>

    <script>
      let fakeData = [];
      const domrepeat = document.querySelector('dom-repeat');
      const ajax = document.createElement('iron-ajax');
      ajax.url = 'catalog.json';

      ajax.generateRequest().completes.then(
        function(event) {
          let packages = event.response.packages;
          for (let el in packages) {
            // If there's a hardcoded demo or docs link, use that
            fakeData.push({
              name: el,
              action: packages[el].description,
              demo: packages[el].demo ? packages[el].demo : `dist/${el}/bower_components/${el}/demo/index.html`,
              docs: packages[el].docs ? packages[el].docs : `dist/${el}/docs.html`
            });
          }
          domrepeat.items = fakeData;

          if (url.query && url.hash) {
            console.log(url.query, url.hash);
            setTimeout(function() {
              var item = document.querySelector(`list-item[name=${url.query}]`);
              if (item) {
                item.doClick(url.hash === 'docs');
              }
            }, 1);
          }
        },
        function(error) {
          console.log('oops');
        }
      );

      window.addEventListener('item-clicked', function(event) {
        url.query = event.detail.name;
        url.hash = event.detail.type;
      });
    </script>
  </body>
</html>
