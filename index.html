<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="Indie elements catalog">
    <meta name="description" content="Indie elements catalog">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>Indie catalog</title>

    <link rel="icon" href="/icons/favicon.ico">

    <!-- See https://goo.gl/OOhYW5 -->
    <link rel="manifest" href="/manifest.json">

    <!-- See https://goo.gl/qRE0vM -->
    <meta name="theme-color" content="#fbbc05">

    <!-- Add to homescreen for Chrome on Android. Fallback for manifest.json -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="indie-catalog">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="indie-catalog">

    <!-- Homescreen icons -->
    <link rel="apple-touch-icon" href="/icons/icon-48x48.png">
    <link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png">

    <!-- Tile icon for Windows 8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="/icons/icon-144x144.png">
    <meta name="msapplication-TileColor" content="#fbbc05">
    <meta name="msapplication-tap-highlight" content="no">

    <link rel="import" href="bower_components/polymer/polymer-element.html">
    <link rel="import" href="bower_components/polymer/lib/elements/dom-repeat.html">
    <link rel="import" href="bower_components/iron-ajax/iron-ajax.html">
    <link rel="import" href="bower_components/iron-location/iron-location.html">
    <link rel="import" href="elements/content-wrapper.html">
    <link rel="import" href="elements/list-item.html">
    <script src="bower_components/webcomponentsjs/webcomponents-loader.js"></script>
    <style>
      html {
        --header-background: #fbbc05;
        --header-foreground: rgba(0,0,0,.7);
      }
      body {
        margin: 0;
        font-family: 'Roboto', 'Noto', sans-serif;
        line-height: 1.5;
        min-height: 100vh;
        background-color: #eeeeee;
      }
      list-item {
        padding: 8px 28px;
      }
    </style>
  </head>
  <body>
    <iron-location id="url" path="null"></iron-location>
    <iron-ajax auto url="catalog.json" handle-as="json" id="ajax"></iron-ajax>
    <content-wrapper>
      <dom-repeat>
        <template>
          <list-item
              name="[[item.name]]"
              action=[[item.action]]
              demo="[[item.demo]]"
              docs="[[item.docs]]">
          </list-item>
        </template>
      </dom-repeat>
    </content-wrapper>

    <noscript>
      Please enable JavaScript to view this website.
    </noscript>

    <script>
      window.addEventListener('WebComponentsReady', function() {
        ajax.addEventListener('response', onResponse);
        ajax.addEventListener('error', onError);
      });

      window.addEventListener('item-clicked', function(event) {
        url.query = event.detail.name;
        url.hash = event.detail.type;
      });

      function onResponse(event) {
        let fakeData = [];
        const domrepeat = document.querySelector('dom-repeat');

        let packages = event.detail.response.packages;
        for (let el in packages) {
          // If there's a hardcoded demo or docs link, use that
          fakeData.push({
            name: el,
            action: packages[el].description,
            demo: packages[el].demo ? packages[el].demo : `dist/${el}/bower_components/${el}/demo/index.html`,
            docs: packages[el].docs ? packages[el].docs : `dist/${el}/docs.html`
          });
        }
        domrepeat.items = fakeData;

        if (url.query && url.hash) {
          setTimeout(function() {
            var item = document.querySelector(`list-item[name=${url.query}]`);
            if (item) {
              item.doClick(url.hash === 'docs');
            }
          }, 1);
        }
      }
      function onError(error) {
        console.log('oops', error);
      }
    </script>
  </body>
</html>
